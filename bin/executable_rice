#!/bin/sh

set -e

main() {
    cli_name=${0##*/}

    cli_help() {
        echo "
Horiceon helper cli
Usage: $cli_name [command]

Commands:
  install|i     install packages

Hint: No/empty command shows help."
        exit 1
    }

    case "$1" in
    install | i)
        install "$@"
        ;;
    docs | d)
        docs "$@"
        ;;
    *)
        cli_help
        ;;
    esac
}

install() {
    cli_help_packages() {
        echo "
Install packages
Usage: $cli_name packages [tool]

Commands:
  arch              arch packages
  code              vscode extensions
  code-optional     optional vscode extensions
  code-languages    language specific vscode extensions
  deb               debian packages
  dwm               install dwm
  fzf               install fzf
  go                go packages
  golang            install go [version]
  npm               npm global packages
  volta             node version manager
  zsh               zsh packages

Hint: No/empty command shows help."
        exit 1
    }

    case "$2" in
    arch)
        if hash yay 2>/dev/null; then
            yay -Syu suckless-tools brave-bin notion-app alacritty zsh neofetch htop neovim code rsync rclone openssh go ttf-dejavu noto-fonts-emoji otf-overpass feh flameshot gpick xsel xcape dunst compton bat exa tmux screen ghostwriter
        else
            echo "Dependency \"yay\" not found."
            exit 1
        fi
        ;;
    code)
        code --install-extension "naumovs.color-highlight"
        code --install-extension "editorconfig.editorconfig"
        code --install-extension "lokalise.i18n-ally"
        code --install-extension "tinkertrain.theme-panda"
        code --install-extension "dominicvonk.parameter-hints"
        code --install-extension "ionutvmi.path-autocomplete"
        code --install-extension "esbenp.prettier-vscode"
        code --install-extension "ow.vscode-subword-navigation"
        code --install-extension "redhat.vscode-yaml"
        ;;
    code-optional)
        code --install-extension "bierner.emojisense"
        code --install-extension "ms-azuretools.vscode-docker"
        code --install-extension "dbaeumer.vscode-eslint"
        code --install-extension "eamodio.gitlens"
        code --install-extension "mkaufman.htmlhint"
        code --install-extension "wix.vscode-import-cost"
        code --install-extension "bierner.markdown-preview-github-styles"
        code --install-extension "silvenon.mdx"
        code --install-extension "ryu1kn.partial-diff"
        code --install-extension "richie5um2.vscode-sort-json"
        code --install-extension "simonsiefke.svg-preview"
        code --install-extension "pflannery.vscode-versionlens"
        code --install-extension "alfnielsen.vsc-rename-files"
        code --install-extension "antfu.browse-lite"
        code --install-extension "ryu1kn.edit-with-shell"
        code --install-extension "pnp.polacode"
        code --install-extension "jock.svg"
        code --install-extension "ryu1kn.text-marker"
        ;;
    code-languages)
        code --install-extension "stylelint.vscode-stylelint"

        code --install-extension "fivethree.vscode-svelte-snippets"
        code --install-extension "svelte.svelte-vscode"

        code --install-extension "octref.vetur"

        code --install-extension "heybourn.headwind"
        code --install-extension "bradlc.vscode-tailwindcss"
        code --install-extension "voorjaar.windicss-intellisense"

        code --install-extension "timonwong.shellcheck"
        code --install-extension "foxundermoon.shell-format"
        ;;
    deb)
        if hash aptitude 2>/dev/null; then
            echo "installing aptitude"
            sudo apt install aptitude
        elif hash apt 2>/dev/null; then
            echo "installing aptitude"

            sudo aptitude install alacritty screen tmux flameshot ghostwriter
        else
            echo "Dependency \"apt\" not found."
            exit 1
        fi
        ;;
    dwm)
        cd ~/.local/src/dwm && git pull && sudo make clean install
        ;;
    fzf)
        chmod +x ~/.local/src/fzf/install
        ~/.local/src/fzf/install --bin
        ;;
    go)
        go get -u github.com/cosmtrek/air github.com/nektos/act github.com/xxxserxxx/gotop/cmd/gotop github.com/yudai/gotty
        ;;
    golang)
        sudo rm -rf /usr/local/go
        if [ "$3" ]; then
            GO_VERSION="go$3"
        else
            GO_VERSION=$(curl -s "https://golang.org/VERSION?m=text")
        fi
        curl --progress-bar "https://dl.google.com/go/$GO_VERSION.linux-amd64.tar.gz" | sudo tar zxf - -C /usr/local
        go version
        ;;
    npm)
        npm i -g pnpm np doctoc prettier js-beautify tinypng-cli diff-so-fancy npm-check-updates sirv-cli live-server firebase-tools markdownlint-cli semver bundle-phobia-cli imagemin imagemin-webp
        ;;
    volta)
        curl https://get.volta.sh | bash -s -- "--skip-setup"
        ;;
    zsh)
        cloneZshModule https://github.com/MichaelAquilina/zsh-you-should-use.git https://github.com/zsh-users/zsh-syntax-highlighting.git https://github.com/sindresorhus/pure.git
        ;;
    *)
        cli_help_packages
        ;;
    esac
}

docs() {
    cli_name=${0##*/}

    cli_help_docs() {
        echo "
Usage: $cli_name docs git|posix|shortcuts|units|vim"
        exit 1
    }

    BASE_CHEZMOI="$(chezmoi source-path)/src/docs/"
    case "$2" in
    git | posix | shortcuts | units | vim)
        less "$BASE_CHEZMOI/$2.md"
        ;;
    *)
        cli_help_docs
        ;;
    esac
}

cloneZshModule() {
    cd "$ZSHPATH" || exit
    for n in "$@"; do
        git clone "$n" 2>/dev/null
    done
}

main "$@"
