#!/usr/bin/env zsh

# general

alias battery-status="upower -i /org/freedesktop/UPower/devices/battery_BAT0 | grep -E 'state|time\ to\ full|percentage'"
alias docker-cleanup="echo 'Cleaning docker images older than 24h' && docker image prune -a --filter 'until=24h'"
alias find-broken-symlinks="find ~/ -xtype l -print"
alias fonts="fc-list"
alias fonts-rebuild="fc-cache -f -v"
alias x-refresh-db="xrdb ~/.Xresources"
alias select-file="xsel -b <"
alias untar="tar xvf"
alias untargz="tar zxvf"
alias untarxz="tar xf"
alias untarbz2="tar xjf"

alias zsh-debug="zprof > zprof-out.txt && less zprof-out.txt && rm zprof-out.txt"

# system

alias rm="trash"
alias history="history 0"

alias cat="bat"

alias vim="$EDITOR"
alias vi="$EDITOR"

alias syslog-crit="sudo dmesg -w -l err,warn"
alias syslog="sudo dmesg -w"
alias ports="netstat -tulpen"

# git

# We wrap in a local function instead of exporting the variable directly in
# order to avoid interfering with manually-run git commands by the user.
__git_prompt_git() {
  GIT_OPTIONAL_LOCKS=0 command git "$@"
}

# Outputs the name of the current branch
git_current_branch() {
  ref=$(__git_prompt_git symbolic-ref --quiet HEAD 2> /dev/null)
  ret=$?
  if [ $ret -ne 0 ]; then
    [ $ret -eq 128 ] && return  # no git repo.
    ref=$(__git_prompt_git rev-parse --short HEAD 2> /dev/null) || return
  fi
  echo "${ref#refs/heads/}"
}

# Outputs the id of the current commit
git_current_commit() {
  ref=$(git rev-list --tags --max-count=1)
  echo "$ref"
}

alias gcmsg='git commit -m'
alias gco='git checkout'
alias gcos="git for-each-ref --format='%(refname:short)' refs/heads | fzf | xargs git checkout"

alias gaa="git add ."
alias gcmsg="git commit -m"

alias gp='git push'
alias gpf='git push --force-with-lease'
alias gpsup='git push --set-upstream origin $(git_current_branch)'

alias gl='git pull'

alias glog='git log --oneline --decorate --graph'
alias gloga='git log --oneline --decorate --graph --all'
alias glol="git log --graph --pretty='%Cred%h%Creset -%C(auto)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset'"
alias gst='git status'
alias gd='git diff'
alias gt='git tag | sort -h'
alias gdesc='git describe --tags $(git_current_commit)'

alias gb='git branch'
alias gbc="git branch --merged | egrep -v '(^\*|master|dev)' | xargs git branch -d && git pull --prune"

alias grv="git remote -v"

alias gsta="git stash save --include-untracked"
alias gstp="git stash pop"

# list

function ls()
{
  if [[ "$1" == -* ]]; then
    exa --colour-scale -bghla -snew $2
  else
    exa --colour-scale -bghla -snew $1
  fi
}

alias la='ls -lAh'
alias l="exa -bghl -snew"
alias ll="exa -bghl -snew"

# npm

alias npmg='npm i -g '
alias npms='npm i -S '
alias npmd='npm i -D '
alias npme='PATH="$(npm bin)":"$PATH"'
alias npmo='npm outdated'
alias npmv='npm -v'
alias npml='npm list'
alias npml0='npm ls --depth=0'
alias npmst='npm start'
alias npmt='npm test'
alias npmr='npm run'
alias npmrs='npm run start'
alias npmp='npm publish'
alias npmin='npm init -y'

alias nv='npm version --no-git-tag-version'
alias nlsg0='npm list -g --depth=0'

# nvm

alias nvmin='nvm install node --reinstall-packages-from=node'

# tmux

alias ta='tmux attach -t'
alias tad='tmux attach -d -t'
alias ts='tmux new-session -s'
alias tl='tmux list-sessions'
alias tksv='tmux kill-server'
alias tkss='tmux kill-session -t'
