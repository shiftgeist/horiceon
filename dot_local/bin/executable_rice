#!/bin/sh

set -e

main() {
    cli_name=${0##*/}

    cli_help() {
        echo "
Horiceon helper cli
Usage: $cli_name [command]

  install i   install packages
  docs d      show docs
  *           help"
        exit 1
    }

    case "$1" in
    install | i)
        install "$@"
        ;;
    docs | d)
        docs "$@"
        ;;
    *)
        cli_help
        ;;
    esac
}

install() {
    cli_help_packages() {
        echo "
Install packages
Usage: $cli_name packages [tool]

Commands:
  arch              arch packages
  code              vscode extensions
  deb               debian packages
  fzf               install fzf
  gopk              go packages
  golang            install go ([version] optional)
  kitty             install kitty terminal
  npm               npm global packages
  volta             node version manager

Hint: No/empty command shows help."
        exit 1
    }

    case "$2" in
    arch)
        if hash yay 2>/dev/null; then
            yay -Syu suckless-tools brave-bin notion-app alacritty zsh neofetch htop neovim code rsync rclone openssh go ttf-dejavu noto-fonts-emoji otf-overpass feh flameshot gpick xsel xcape compton exa tmux screen ghostwriter rofi
        else
            echo "Dependency \"yay\" not found."
            exit 1
        fi
        ;;
    code)
        # code --install-extension "EXTENSION_ID"                         # WHY?
        code --install-extension "ahmadawais.shades-of-purple"            # theme
        code --install-extension "bierner.emojisense"                     # utility
        code --install-extension "bierner.markdown-mermaid"               # markdown
        code --install-extension "bierner.markdown-preview-github-styles" # markdown
        code --install-extension "deque-systems.vscode-axe-linter"        # lint
        code --install-extension "eamodio.gitlens"                        # git
        code --install-extension "editorconfig.editorconfig"              # lint
        code --install-extension "formulahendry.code-runner"              # utility
        code --install-extension "lokalise.i18n-ally"                     # utility
        code --install-extension "ms-vscode-remote.remote-containers"     # docker
        code --install-extension "naumovs.color-highlight"                # utility
        code --install-extension "ow.vscode-subword-navigation"           # utility
        code --install-extension "simonsiefke.prettier-vscode"            # lint
        code --install-extension "timonwong.shellcheck"                   # lint
        code --install-extension "waderyan.gitblame"                      # git
        code --install-extension "wdhongtw.gpg-indicator"                 # git
        code --install-extension "webhint.vscode-webhint"                 # lint
        code --install-extension "zengxingxin.sort-js-object-keys"        # utility
        ;;
    deb)
        sudo apt-get install tmux flameshot ghostwriter zsh telnet git vim htop nload dstat net-tools rofi git-merge-changelog
        ;;
    fzf)
        chmod +x ~/.local/src/fzf/install
        ~/.local/src/fzf/install --bin
        ;;
    gopkg)
        go get -u github.com/cosmtrek/air github.com/nektos/act github.com/xxxserxxx/gotop/cmd/gotop github.com/yudai/gotty
        ;;
    golang)
        sudo rm -rf /usr/local/go
        if [ "$3" ]; then
            GO_VERSION="go$3"
        else
            GO_VERSION=$(curl -s "https://go.dev/VERSION?m=text")
        fi
        curl --progress-bar "https://dl.google.com/go/$GO_VERSION.linux-amd64.tar.gz" | sudo tar zxf - -C /usr/local
        go version
        ;;
    kitty)
        curl -L https://sw.kovidgoyal.net/kitty/installer.sh | sh /dev/stdin
        ln -s ~/.local/kitty.app/bin/kitty ~/.local/bin/
        cp ~/.local/kitty.app/share/applications/kitty.desktop ~/.local/share/applications/
        sed -i "s|Icon=kitty|Icon=/home/$USER/.local/kitty.app/share/icons/hicolor/256x256/apps/kitty.png|g" ~/.local/share/applications/kitty.desktop
        ;;
    npm)
        volta install pnpm doctoc prettier js-beautify tinypng-cli diff-so-fancy npm-check-updates markdownlint-cli semver bundle-phobia-cli imagemin imagemin-webp zx
        ;;
    volta)
        curl https://get.volta.sh | bash -s -- "--skip-setup"
        ;;
    *)
        cli_help_packages
        ;;
    esac
}

docs() {
    cli_name=${0##*/}
    BASE_CHEZMOI="$(chezmoi source-path)/docs/"

    cli_help_docs() {
        echo "
Usage: $cli_name docs TOPIC

TOPICS:
$(ls -1 $BASE_CHEZMOI | sed -e 's/\.md$//')"
        exit 1
    }

    if [ -f "$BASE_CHEZMOI/$2.md" ]; then
        less "$BASE_CHEZMOI/$2.md"
    else
        cli_help_docs
    fi
}

main "$@"
