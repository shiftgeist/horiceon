#!/usr/bin/env zsh

# general

alias battery-status="upower -i /org/freedesktop/UPower/devices/battery_BAT0 | grep -E 'state|time\ to\ full|percentage'"
alias docker-cleanup="echo 'Cleaning docker images older than 24h' && docker image prune -a --filter 'until=24h'"
alias find-broken-symlinks="find ~/ -xtype l -print"
alias fonts="fc-list"
alias fonts-rebuild="fc-cache -f -v"
alias x-refresh-db="xrdb ~/.Xresources"
alias select-file="xsel -b <"
alias untar="tar xvf"
alias untargz="tar zxvf"
alias untarxz="tar xf"
alias untarbz2="tar xjf"

alias zsh-debug="zprof > zprof-out.txt && less zprof-out.txt && rm zprof-out.txt"

# system

alias history="history 0"

alias cat="bat"

alias vim="$EDITOR"
alias vi="$EDITOR"

alias syslog-crit="sudo dmesg -w -l err,warn"
alias syslog="sudo dmesg -w"
alias ports="netstat -tulpen"

alias killp="pkill"

# git

# We wrap in a local function instead of exporting the variable directly in
# order to avoid interfering with manually-run git commands by the user.
__git_prompt_git() {
  GIT_OPTIONAL_LOCKS=0 command git "$@"
}

# Outputs the name of the current branch
git_current_branch() {
  ref=$(__git_prompt_git symbolic-ref --quiet HEAD 2> /dev/null)
  ret=$?
  if [ $ret -ne 0 ]; then
    [ $ret -eq 128 ] && return  # no git repo.
    ref=$(__git_prompt_git rev-parse --short HEAD 2> /dev/null) || return
  fi
  echo "${ref#refs/heads/}"
}

# Outputs the id of the current commit
git_current_commit() {
  ref=$(git rev-list --tags --max-count=1)
  echo "$ref"
}

alias gco="git checkout"
function gch() {
  git checkout "$(gb --all | fzf | tr -d '[:space:]')"
}

alias gaa="git add ."
alias gcm="git commit -m"
alias gcam="git add . && git commit -m"

alias gp="git push"
alias gpf="git push --force-with-lease"
function gpsup() {
  git push --set-upstream origin $(git_current_branch)
}

alias gl="git pull"

alias glog="git log --oneline --decorate --graph"
alias gloga="git log --oneline --decorate --graph --all"
alias glol="git log --graph --pretty='%Cred%h%Creset -%C(auto)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset'"
alias gst="git status"
alias gd="git diff"
alias gt="git tag | sort -h"
function gdesc() {
  git describe --tags $(git_current_commit)
}

alias gb="git branch"
alias gbc="git branch --merged | egrep -v '(^\*|master|dev)' | xargs git branch -d && git pull --prune"

alias grv="git remote -v"

alias gsta="git stash save --include-untracked"
alias gstp="git stash pop"

# git flow

alias gflf='git flow feature'
alias gflh='git flow hotfix'
alias gflr='git flow release'
alias gflfs='git flow feature start'
alias gflhs='git flow hotfix start'
alias gflrs='git flow release start'
alias gflff='git flow feature finish'
alias gflfp='git flow feature publish'
alias gflhf='git flow hotfix finish'
alias gflrf='git flow release finish'
alias gflfp='git flow feature publish'
alias gflhp='git flow hotfix publish'
alias gflrp='git flow release publish'
alias gflfpll='git flow feature pull'

# list

alias ls="exa"
alias la="ls -lah"

# npm

alias npmg="npm i -g"
alias npms="npm i -S"
alias npmd="npm i -D"
alias npmo="npm outdated"
alias npmv="npm -v"
alias npml="npm list"
alias npml0="npm ls --depth=0"
alias npmlg0="npm list -g --depth=0"
alias npmst="npm start"
alias npmt="npm test"
alias npmr="npm run"
alias npmrs="npm run start"
alias npmp="npm publish"
alias npmin="npm init -y"

alias nv="npm version --no-git-tag-version"

# nvm

alias nvmin="nvm install node --reinstall-packages-from=node"

# tmux

alias ta="tmux attach -t"
alias tad="tmux attach -d -t"
alias ts="tmux new-session -s"
alias tl="tmux list-sessions"
alias tksv="tmux kill-server"
alias tkss="tmux kill-session -t"
